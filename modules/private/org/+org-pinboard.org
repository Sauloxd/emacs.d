#+TITLE: Pinboard
#+AUTHOR: Florian SchrÃ¶dl (floscr)
#+PROPERTY: header-args :tangle yes
#+STARTUP: org-startup-folded: showall
#+BEGIN_SRC emacs-lisp
;; -*- lexical-binding: t -*-
#+END_SRC

* Main

** Config

#+BEGIN_SRC elisp
(setq org-pinboard-dir org-directory)
(setq org-pinboard-file (concat org-pinboard-dir "/Bookmarks/bookmarks.org"))
(setq org-pinboard-archive-file (concat org-pinboard-dir "/Bookmarks/.archive/pinboard.org"))
#+END_SRC

** Refile to pinboard

#+BEGIN_SRC elisp
(defun +pinboard|refile ()
  (interactive)
  (require 'om)
  (let* ((item (om-parse-this-headline))
         (headline (om-get-property :raw-value item))
         (headline-match (s-match "^\\[\\[\\(.+\\)\\]\\[\\(.*\\)\\]\\]" headline))
         (new-item
          (--> item
               (om-set-property :level 2 it)
               (om-headline-set-title! (nth 2 headline-match) nil it)
               (om-set-property :todo-keyword nil it)
               (om-headline-set-node-property "URL" (nth 1 headline-match) it)
               (om-to-string it))))
    (call-interactively #'org-cut-subtree)
    (find-file org-pinboard-file)
    (goto-char (point-max))
    (insert "\n")
    (insert new-item)
    (call-interactively #'+org|counsel-org-tag)))

(defun +pinboard|refile-agenda ()
  (interactive)
  (org-agenda-switch-to)
  (+pinboard|refile))
#+END_SRC
